<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日曜出欠確認 (Ver 5.0 Layout Fix)</title>
    <style>
        :root {
            --primary: #4a90e2;
            --bg: #f8f9fa;
            --text: #333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: sans-serif;
            background: var(--bg);
            color: var(--text);
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* Calendar Styles */
        .date-btn {
            background: #fff;
            border: 1px solid #ccc;
            padding: 8px;
            margin: 4px;
            display: inline-block;
            cursor: pointer;
            border-radius: 4px;
            min-width: 40px;
            text-align: center;
        }

        .date-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .month-group {
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .month-title {
            font-weight: bold;
            border-bottom: 1px solid #eee;
            margin-bottom: 10px;
            padding-bottom: 5px;
            color: var(--primary);
        }

        /* Form Styles */
        .form-section,
        .result-section {
            display: none;
            background: white;
            padding: 20px;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        /* Radio Button Fix */
        .radio-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .radio-label {
            display: flex !important;
            align-items: center;
            font-weight: normal !important;
            cursor: pointer;
        }

        .radio-label input {
            margin-right: 6px;
        }

        .btn-submit {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-submit:hover {
            opacity: 0.9;
        }

        .btn-submit:disabled {
            background: #ccc;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th,
        td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }

        th {
            background: #f1f1f1;
        }

        /* Debug Box */
        .debug-box {
            margin-top: 40px;
            padding: 15px;
            background: #222;
            color: #0f0;
            font-family: monospace;
            border-radius: 5px;
            font-size: 11px;
            line-height: 1.4;
        }
    </style>
</head>

<body>

    <div class="container">
        <header style="text-align: center; margin-bottom: 20px;">
            <h1>日曜出欠確認 (Ver 5.0)</h1>
            <p>日付をクリックして入力してください</p>
        </header>

        <div id="calendar"></div>

        <div id="formSection" class="form-section">
            <h2 id="selectedDateTitle" style="margin-bottom: 15px;"></h2>
            <form id="attendanceForm">
                <input type="hidden" id="inputDate" name="date">

                <label>名前</label>
                <select id="inputName" name="name" required>
                    <option value="">読込中...</option>
                </select>

                <label>出欠</label>
                <div class="radio-container">
                    <label class="radio-label">
                        <input type="radio" name="status" value="出席" checked> 出席
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="status" value="欠席"> 欠席
                    </label>
                </div>

                <label>備考</label>
                <input type="text" name="comment" placeholder="ひとことメモ">

                <button type="submit" id="submitBtn" class="btn-submit">送信する</button>
            </form>
        </div>

        <div id="resultSection" class="result-section">
            <h3>出席状況一覧</h3>
            <table id="resultTable">
                <thead>
                    <tr>
                        <th>名前</th>
                        <th>出欠</th>
                        <th>備考</th>
                    </tr>
                </thead>
                <tbody id="resultBody"></tbody>
            </table>
        </div>

        <div class="debug-box">
            <h3>▼ デバッグ情報</h3>
            <p>うまく動かない場合はここを確認してください</p>
            <div id="debugLog">待機中...</div>
        </div>
    </div>

    <div id="loading"
        style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.8);display:none;justify-content:center;align-items:center;font-weight:bold;color:var(--primary);">
        読み込み中...
    </div>

    <script>
    // ▼▼▼ ここを新しいURLに書き換えてください ▼▼▼
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycby_xD1P2joz-Nkn0ebTXs6EDZRxC3fY05VOheUkMYvkJo0sxH7SRZBpS67HlSfLycX5ig/exec";
         / ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲            ▲▲

    function log(m                  const d = new Date();
        const t =            urs() + ":" + String(d.getMinutes()).padStart(2,'0') + ":" + String(d.getSeconds()).padStart(2,'0');
        const box =        ume        etElementById('debugL        ;
        box.inne            `<div><span style="color:#888">[${t}]</span> ${msg}</d            ox.innerHTML;
    }

    // Initialize Calendar
                 init() {
        const cal = document.getEle                lendar');
        for (let m = 3;                +) {
            const grp = documene                           grp.className = 'month-group';
                 / Month Header
            const title = document.createElement('div                 ssName = 'month-title';
                                = m + "月";
            grp.appendChil                           let date = new Date(2026, m - 1, 1, 12,                         pprox
            while (dat                         1) {
                if (date.getDay() ===0                            st btn = document.crea t eElement('div' );
                                                          const ymd = da te.get                                                        String                        padStart(2,'0') + '-' + 
                                              e.getDate()).padStart(                                          nerText = date.getDate() + '日';
                                    ick = () => selectDate(y                                  grp.appendC            );                         }
                date.setDate(date.            ) + 1);
            }
            cal.appendChild(grp);
        }
    }

    async              selectDate(dateStr, btn) {
 o            uerySelectorAll('.date-btn').forEach(b => b.classList.            active'));
        btn.classList.add('active');
        document.gt            putDate').value = dateStr             t.getE                selectedDateTitle').innerText = d                     log(`日付選択: ${dateStr}`);
        document.getElementById('loading').st                = 'flex';

        try {
      r                etch(`${GAS_API_URL}?date=${dateStr}&t=${Date.now()}`);
            constt                
            
                    how data in log
            log(`★取得完了: メンバー${data.me                }名, 出欠${data.attendance.length}件`);
            if(data.d                                log(`[シート確認]                    N.stringify(data.debug_raw)}`);
            }
                    Update Dropdown                    st sel = document.g                    nputName');
            s                 = '<                ="">選択してください</opti                      data.members.forEach(m => {
                con                ument.createElement('o                             opt.value = m;
                         innerText = m;
                sel.append                             });

            // Update Table
            const tbody = document.getElem                    Body');
            tbo                 = ''                  data.attendance.forEach(row => {
                const tr = do                eElement('tr');
                tr.innerHTML = `<td>${row.name}</t                status}</td><td>${row.comment}</td>`;
                t body.appe ndChild( tr);
                }); 

                    ment.getElementById('formS                le.display = 'block';
                       t.        lem        yId('resultSection').style.display = 'block';
            document.g            tById('formSection')            ntoView({ behavior: 'smooth' });

              catch(e) {
            log(`エラー発生: ${e.message             alert("データの取得に失敗しました。URLを確認してください。");
                   ly {
            document.getElementById('loading').sty            ay = '                   }
    }

    document.getElementById('attendanceForm').onsu                 (e) => {
        e.prevent                       const fd = ne                    get);
        con                    .fromEntri es(fd.entries());
        do cum                    Id('submitBtn').disabled =                   loo                son.status}`);

        try {
                    t fetch(GAS_API_URL                        method: 'PO                         mode: 'no-cors',
                headers: { 'Conte                    plain' },
                body: JSON.stringify(json)
            })                  
                    imeout( () =>                       alert("送信しました");
                     ocument.getElementById('submitBtn').disabled = false;
                        sel        ate(json.daument.querySelector('.date-btn.active'));
            }, 1000);
        } catch(err) {
            log(`送信エラー: ${err.message}`);
            document.getElementById('submitBtn').disabled = false;
        }
    };

    init();
    </script>
</body>

</html>